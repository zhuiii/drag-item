{"remainingRequest":"E:\\Vue\\drag-item\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\Vue\\drag-item\\src\\components\\drag-list.vue?vue&type=style&index=0&lang=scss&","dependencies":[{"path":"E:\\Vue\\drag-item\\src\\components\\drag-list.vue","mtime":1621233820425},{"path":"E:\\Vue\\drag-item\\node_modules\\css-loader\\index.js","mtime":1622988248744},{"path":"E:\\Vue\\drag-item\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1622988290534},{"path":"E:\\Vue\\drag-item\\node_modules\\postcss-loader\\src\\index.js","mtime":1622988295317},{"path":"E:\\Vue\\drag-item\\node_modules\\sass-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\Vue\\drag-item\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1622988269105},{"path":"E:\\Vue\\drag-item\\node_modules\\vue-loader\\lib\\index.js","mtime":1622988290507}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.drag-box{\n\twidth: 100%;\n\theight: 100%;\n\tposition: relative;\n\t.drag-item{\n\t\twidth: 100%;\n\t\ttext-align: center;\n\t\ttransition: all 0.5s;\n\t\tbackground-color: #fff;\n\t\tz-index: 1;\n\t\tborder-bottom: 1rpx solid #F5F5F5;\n\t\tposition: absolute;\n\t}\n}\n.drag-active{\n\tbox-shadow: 0 8px 20px 0 #e6e6e6;\n\ttransform: scale(1.1);\n\tz-index: 9 !important;\n\ttransition:  box-shadow .5s, transform .5s, top 0s !important;\n}\n",{"version":3,"sources":["drag-list.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"drag-list.vue","sourceRoot":"src/components","sourcesContent":["<template>\n\t<view class=\"drag-box\">\n\t\t<view \r\n\t\t\tv-for=\"(item,index) in dataList\"\r\n\t\t\t:key=\"index\"\r\n\t\t\t:style=\"{top: item.top +'px',\r\n\t\t\t\theight: (itemHeight - 1)+'rpx'}\"\r\n\t\t\tclass=\"drag-item\"\r\n\t\t\t:class=\"{'drag-active': item.isActive}\"\r\n\t\t\t@longtap=\"longtap(item)\"\r\n\t\t\t@touchstart=\"touchstart\"\r\n\t\t\t@touchmove.stop.prevent=\"touchmove\"\r\n\t\t\t@touchend=\"touchend(item)\">\r\n\t\t\t\t<slot :item=\"item\"></slot>\r\n\t\t</view>\n\t</view>\n</template>\n\n<script>\n\texport default {\r\n\t\tprops: {\r\n\t\t  list: {\r\n\t\t    type: Array,\r\n\t\t    default: () => ([])\r\n\t\t  },\r\n\t\t  itemHeight: {\r\n\t\t    type: [Number],\r\n\t\t    default: 70\r\n\t\t  }\r\n\t\t},\n\t\tdata() {\n\t\t\treturn {\r\n\t\t\t\tactiveItem: null,\r\n\t\t\t\tisDrag: false,\r\n\t\t\t\tdragTargetY: 0,\r\n\t\t\t\tdataList: [],\r\n\t\t\t\tsortIndexList: [],\r\n\t\t\t}\n\t\t},\r\n\t\twatch: {\r\n\t\t  list: {\r\n\t\t    immediate: true,\r\n\t\t    deep: true,\r\n\t\t    handler (list) {\r\n\t\t      this.setList(list)\r\n\t\t    }\r\n\t\t  }\r\n\t\t},\n\t\tmethods: {\n\t\t\ttouchstart(e){\r\n\t\t\t\tthis.dragTargetY = e.touches[0].pageY;\r\n\t\t\t},\r\n\t\t\tlongtap(item){\r\n\t\t\t\tthis.activeItem = item;\r\n\t\t\t\tthis.isDrag = true;\r\n\t\t\t\titem.isActive = true;\r\n\t\t\t},\r\n\t\t\ttouchmove(e){\r\n\t\t\t\tif(!this.isDrag){\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\tlet newY = e.touches[0].pageY;\r\n\t\t\t\tlet d = newY - this.dragTargetY;\r\n\t\t\t\tthis.activeItem.top += d;\r\n\t\t\t\t\r\n\t\t\t\tlet prevIndex = this.sortIndexList[this.activeItem.index] - 1;\r\n\t\t\t\tlet nextIndex = this.sortIndexList[this.activeItem.index] + 1;\r\n\t\t\t\tif (prevIndex >= 0 && d < 0){\r\n\t\t\t\t\tlet item = this.getItemByIndex(prevIndex);\r\n\t\t\t\t\tif (this.activeItem.top < item.top){\r\n\t\t\t\t\t\tthis.swapArray(item);\r\n\t\t\t\t\t}\r\n\t\t\t\t}else if (nextIndex < this.list.length && d > 0) {\r\n\t\t\t\t\tlet item = this.getItemByIndex(nextIndex);\r\n\t\t\t\t\tif (this.activeItem.top > item.top){\r\n\t\t\t\t\t\tthis.swapArray(item);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis.dragTargetY = newY;\r\n\t\t\t},\r\n\t\t\ttouchend(item){\r\n\t\t\t\tif(!this.isDrag){\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\tthis.isDrag = false;\r\n\t\t\t\titem.isActive = false;\r\n\t\t\t\tthis.activeItem.top = this.sortIndexList[this.activeItem.index] * this.rowHeight;\r\n\t\t\t\tlet sortList = [];\r\n\t\t\t\tArray(this.dataList.length).fill(0).forEach((v,index)=>{\r\n\t\t\t\t\tlet tempObj = this.deepClone(this.getItemByIndex(index));\r\n\t\t\t\t\tdelete tempObj.isActive;\r\n\t\t\t\t\tdelete tempObj.top;\r\n\t\t\t\t\tdelete tempObj.index;\r\n\t\t\t\t\tsortList.push(tempObj);\r\n\t\t\t\t});\r\n\t\t\t\tthis.$emit('change', sortList);\r\n\t\t\t},\r\n\t\t\tgetItemByIndex(index){\r\n\t\t\t\tfor (let i = 0;i < this.sortIndexList.length;i++){\r\n\t\t\t\t\tif (this.sortIndexList[i] === index){\r\n\t\t\t\t\t\treturn this.dataList[i];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn null;\r\n\t\t\t},\r\n\t\t\tswapArray(item) {//列表中两个元素交换位置\r\n\t\t\t\tlet index = this.sortIndexList[this.activeItem.index];\r\n\t\t\t\tthis.sortIndexList[this.activeItem.index] = this.sortIndexList[item.index];\r\n\t\t\t\tthis.sortIndexList[item.index] = index;\r\n\t\t\t\titem.top = index * this.rowHeight;\r\n\t\t\t\tthis.count = 0;\r\n\t\t\t},\r\n\t\t\tsetList(list){\r\n\t\t\t\tthis.dataList = list.map((item, index) => {\r\n\t\t\t\t  this.sortIndexList.push(index);\r\n\t\t\t\t  return {\r\n\t\t\t\t    ...item,\r\n\t\t\t\t    isActive: false,\r\n\t\t\t\t\ttop: index * this.rowHeight,\r\n\t\t\t\t\tindex: index\r\n\t\t\t\t  }\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tdeepClone(obj){\r\n\t\t\t    let result={},oClass=this.isClass(obj);\r\n\t\t\t\tconsole.log(oClass)\r\n\t\t\t\tfor(let key in obj){\r\n\t\t\t\t\tlet copy=obj[key];\r\n\t\t\t\t\tif(this.isClass(copy)==\"Object\"){\r\n\t\t\t\t\t\tresult[key]=arguments.callee(copy);\r\n\t\t\t\t\t}else if(this.isClass(copy)==\"Array\"){\r\n\t\t\t\t\t\tresult[key]=arguments.callee(copy);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tresult[key]=obj[key];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn result;\r\n\t\t\t},\r\n\t\t\tisClass(o){\r\n\t\t\t    if(o===null) return \"Null\";\r\n\t\t\t\tif(o===undefined) return \"Undefined\";\r\n\t\t\t\treturn Object.prototype.toString.call(o).slice(8,-1);\r\n\t\t\t}\n\t\t},\r\n\t\tmounted() {\r\n\t\t},\r\n\t\tcomputed:{\r\n\t\t\trowHeight(){\r\n\t\t\t\tconst res = uni.getSystemInfoSync();\r\n\t\t\t\tlet screenWidth = res.screenWidth;\r\n\t\t\t\tif (this.itemHeight){\r\n\t\t\t\t\treturn this.itemHeight*screenWidth/750;\r\n\t\t\t\t}else{\r\n\t\t\t\t\treturn 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\n\t}\n</script>\n\n<style lang=\"scss\">\r\n\t.drag-box{\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t\tposition: relative;\r\n\t\t.drag-item{\r\n\t\t\twidth: 100%;\r\n\t\t\ttext-align: center;\r\n\t\t\ttransition: all 0.5s;\r\n\t\t\tbackground-color: #fff;\r\n\t\t\tz-index: 1;\r\n\t\t\tborder-bottom: 1rpx solid #F5F5F5;\r\n\t\t\tposition: absolute;\r\n\t\t}\r\n\t}\r\n\t.drag-active{\r\n\t\tbox-shadow: 0 8px 20px 0 #e6e6e6;\r\n\t\ttransform: scale(1.1);\r\n\t\tz-index: 9 !important;\r\n\t\ttransition:  box-shadow .5s, transform .5s, top 0s !important;\r\n\t}\n</style>"]}]}